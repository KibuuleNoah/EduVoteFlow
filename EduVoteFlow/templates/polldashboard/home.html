{% extends 'polldashboard/polldashboardbase.html' %}

{% block viewer %}
<div class="text-white">
  <div class="content">
    <div class="dashboard-header text-center">
      <h1 class="text-info">Welcome, Admin</h1>
      <p>Manage the school election efficiently</p>
    </div>
      
    <h4 class="mt-2 mb-4 display-3 text-center">
      {{poll.name}} 
      <sup class="
        {% if status == "Active" %}
        text-success
        {% elif status == "Scheduled" %}
        text-warning
        {% elif status == "Archived" %}
        text-danger
        {% endif %}
        " 
        style="font-size:1rem;"
        >{{status}}</sup>
    </h4>
    {% if status == "Active" %}
      <div class="elecstart">
			<center>
      <div class="card bg-dark text-white" style="max-width: 20rem">
        <div class="card-header p-1">
          <div class="col p-0 m-0">
            <span class="text-info">Election link</span> 
          </div>
          <div class="col d-flex justify-content-end px-3 m-0">
            <i class='bx bx-copy' onclick="copyToClipboard(event,'{{link}}')"> copy</i>
          </div>
        </div>
        <div class="card-body text-nowrap overflow-auto p-2">
          {{link}}
        </div>
      </div>

				<br><br>
				<a href="{{link}}" class="btn btn-outline-info">Go to Student Login</a>
			</center>
		</div>
   {% else %}
      <form method="POST" method="/" class='elecstart'>
         <center>
         <a href="{{ url_for('polls.start_election', school_id=school.id, poll_id=poll.id) }}" class="btn btn-outline-info m-5"><i class="bx bx-bar-chart-alt-2"></i> Start Election</a>
         </center>
      </form>
   {% endif %}

    <!-- Overview Section -->
    <section id="overview" class="mt-5">
      <h2 class="text-info">Overview</h2>
      <div class="row">
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Total Candidates</h4>
              <h3>{{len_cand}}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Total Voters</h4>
              <h3>{{len_stud}}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Votes Cast</h4>
              <h3>{{poll.total_votes}}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Voted Students</h4>
              <h3>{{poll.total_voted}}</h3>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Top 5 Candidates Section -->
    <section class="mt-5"id="candidates">
      <h2 class="text-info">Top 5 Candidates</h2>
      <table class="table table-dark table-bordered">
        <thead>
          <tr>
            <th>Name</th>
            <th>Position</th>
            <th>Grade</th>
            <th>Gender</th>
            <th>Votes</th>
          </tr>
        </thead>
        <tbody>
          {% for candidate in top_candidates  %}
          <tr>
            <td>{{candidate.name}}</td>
            <td>{{candidate.post}}</td>
            <td>{{candidate.grade}}</td>
            <td>{{candidate.gender}}</td>
            <td>{{candidate.votes}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <!-- Unopposed Candidates Section -->
    <section class="mt-5 mb-3" id="unopposed-candidates">
      <h2 class="text-info">Unopposed Candidates</h2>
      <small class="text-warning mt-2 mb-3">These candidates won automatically because they have no opponet</small>
      <table class="table table-dark table-bordered">
        <thead>
          <tr>
            <th>Name</th>
            <th>Position</th> 
            <th>Grade</th>
            <th>Gender</th>
          </tr>
        </thead>
        <tbody>
          {% for candidate in unopposed  %}
          
          <tr>
            <td>{{candidate.name}}</td>
            <td>{{candidate.post}}</td>
            <td>{{candidate.grade}}</td>
            <td>{{candidate.gender}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  </div>
</div>
<div class="d-flex justify-content-end mt-5">
  <a href="#" class="text-danger" data-bs-toggle="modal" data-bs-target="#delete-poll-modal">
    <i class="bx bx-trash"></i>
    Delete Poll
  </a>
  <div>
  <!-- Modal -->
<div class="modal fade" id="delete-poll-modal" tabindex="-1" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content bg-dark">
      <div class="modal-header">
        <h1 class="modal-title text-danger fs-5" id=""><center>Sure you want to proceed with the Deletion ?<br>This poll will pemanently be deleted!</center></h1>  
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-info" data-bs-dismiss="modal">Cancel</button>
        <a href="{{url_for('polls.delete_poll',poll_id=poll.id)}}" class="btn btn-danger">proceed</a>
      </div>
    </div>
  </div>
</div>

{% endblock viewer %}

{% block scripts %}
  <script>
    function copyToClipboard(event,text) {
      const tempTextInput = document.createElement('input');
      tempTextInput.value = text.trim();
      document.body.appendChild(tempTextInput);
      tempTextInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempTextInput);
      
      // Change icon to tick
      const icon = event.target;
      icon.className = 'bx bx-check text-success';
      icon.innerText = " copied"
      
      // Set timeout to revert icon back to copy after 5 seconds
      setTimeout(() => {
        icon.className = 'bx bx-copy';
        icon.innerText = " copy"
      }, 3000);
      // Optional: You can display a confirmation message
    }
  </script>
{% endblock scripts %}


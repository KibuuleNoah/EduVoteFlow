{% extends 'polldashboard/polldashboardbase.html' %}

{% block viewer %}
<div class="container mt-5">
  <div class="text-center mb-5">
    <h1 class="display-4">{{poll.name}} {{poll.year}}</h1>
    <p class="lead">Congratulations to all participants!</p>
  </div>

  <section>
    <div class="row">
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Total Candidates</h4>
              <h3>{{len_cand}}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Total Voters</h4>
              <h3>{{len_stud}}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Votes Cast</h4>
              <h3>{{poll.total_votes}}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-dark text-white text-center mb-4">
            <div class="card-body">
              <h4>Voted Students</h4>
              <h3>{{poll.total_voted}}</h3>
            </div>
          </div>
        </div>
      </div>

  </section>

  <div class="row">
    <div class="col-md-6 m-0">
      <h1 class="text-center text-success">
        <span><i class="bx bxs-trophy"></i> Winners</span>
      </h1>
      <div class="res-table-cont">
        <table class="table table-hover table-dark">
          <thead class="thead-light">
            <tr>
              <th scope="col">Position</th>
              <th scope="col">Candidate</th>
              <th scope="col">Votes</th>
            </tr>
          </thead>
          <tbody>
            {% for unopposed_cand in unopposed_cands  %}
            <tr>
              <th scope="row" style="color: gold;">{{unopposed_cand["post"]}}</th>
              <td style="color: gold;">{{unopposed_cand["full_name"]}}</td>
              <td style="color: gold;">flat</td>
            </tr>
            {% endfor %}
            {% for winner in winners %}
            <tr class="text-success">
              <th scope="row">{{winner["post"]}}</th>
              <td>{{winner["full_name"]}}</td>
              <td>{{winner["votes"]}}</td>
            </tr>
            {% endfor %}
            <tr>
              <td colspan="3">
                <center>
                  <button type="button" class="btn btn-outline-info border-0"><i class="bx bx-download"></i> Download</button>
                </center>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-md-6 m-0">
      <h1 class="text-center text-danger">
        <span><i class="bx bxs-sad"></i> Losers</span>
      </h1>

      <div class="res-table-cont">
        <table class="table table-hover table-dark">
          <thead class="thead-light">
            <tr>
              <th scope="col">Position</th>
              <th scope="col">Candidate</th>
              <th scope="col">Votes</th>
            </tr>
          </thead>
          <tbody>
            {% for loser in losers %}
            <tr class="text-danger">
              <th scope="row">{{loser["post"]}}</th>
              <td>{{loser["full_name"]}}</td>
              <td>{{loser["votes"]}}</td>
            </tr>
            {% endfor %}
            <tr>
              <td colspan="3">
                <center>
                  <button type="button" class="btn btn-outline-info border-0"><i class="bx bx-download"></i> Download</button>
                </center>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-6">
      <center>
        <button type="button" class="btn btn-outline-info"><i class="bx bx-download"></i> Download</button>
      </center>
    </div>
    <div class="col-6">
      <center>
        <button type="button" class="btn btn-outline-info"><i class="bx bx-download"></i> Download</button>
      </center>
    </div>
  </div>

  <section class="mt-3">
    {% for post in results  %}
    
  <div class="card bg-vis-dark mb-4">
    <div class="card-header text-center bg-dark text-white">
      <h3>{{post}}-{{results[post]["votes_casted"]}}</h3>

    </div>
    <div class="card-body">
      <div class="row">
        {% for candidate in results[post]["winners"]  %}
        
        <!-- Winner Card -->
        <div class="col-12 col-md-4 col-lg-3 mb-4">
        {% if results[post]["any_tie"] %}
        <div class="card text-white h-100 border-warning bg-dark">
            <div class="card-body text-center position-relative">
              <div class="position-relative d-inline-block">
                <img
                    src="https://via.placeholder.com/100"
                    class="img-fluid rounded-circle border border-warning"
                    alt="Avatar"
                    style="border-width: 4px"
                    />
                <span
                    class="position-absolute top-0 start-100 translate-middle p-2 bg-warning rounded"
                    >
                    <i class="bx bx-lock text-white"></i>
                </span>
              </div>
              <h5 class="card-title mt-3">{{candidate["full_name"]}}</h5>
              <p class="card-text">
              <i class="bx bx-{{candidate["gender"]|lower}}"></i> {{candidate["gender"]}}<br />
              <i class="bx bxs-home"></i> {{candidate["house"]}}
              </p>
              <div class="progress">
                <div
                    class="progress-bar bg-warning"
                    role="progressbar"
                    style="width: {{candidate["percentage"]}}%"
                    aria-valuenow="{{candidate["percentage"]}}"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    >
                </div>
              </div>
              <span class="text-warning">{{candidate["percentage"]}}%</span>
            </div>
          </div>
        {% else %}
        <div class="card h-100 text-white border-success bg-dark">
            <div class="card-body text-center position-relative">
              <div class="position-relative d-inline-block">
                <img
                    src="https://via.placeholder.com/100"
                    class="img-fluid rounded-circle border border-success"
                    alt="Avatar"
                    style="border-width: 4px"
                    />
                <span
                    class="position-absolute top-0 start-100 translate-middle p-2 bg-success rounded"
                    >
                    {% if results[post]["any_tie"] %}
                    <i class="bx bx-lock text-white"></i>
                    {% endif %}
                    <i class="bx bx-crown text-white"></i>
                </span>
              </div>
              <h5 class="card-title mt-3">{{candidate["full_name"]}}</h5>
              <p class="card-text">
              <i class="bx bx-{{candidate["gender"]|lower}}"></i> {{candidate["gender"]}}<br />
              <i class="bx bxs-home"></i> {{candidate["house"]}}
              </p>
              <div class="progress">
                <div
                    class="progress-bar bg-success"
                    role="progressbar"
                    style="width: {{candidate["percentage"]}}%"
                    aria-valuenow="{{candidate["percentage"]}}"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    >
                </div>
              </div>
              <span class="text-success">{{candidate["percentage"]}}%</span>
            </div>
          </div>
        {% endif %}  
        </div>
        {% endfor %}

        {% for candidate in results[post]["losers"]  %}
        <div class="col-12 col-md-4 col-lg-3 mb-4">
          <div class="card bg-dark text-white h-100">
            <div class="card-body text-center">
              <img
                  src="https://via.placeholder.com/100"
                  class="img-fluid rounded-circle mb-3"
                  alt="Avatar"
                  />
              <h5 class="card-title">{{candidate["full_name"]}}</h5>
              <p class="card-text">
              <i class="bx bx-{{candidate["gender"]|lower}}"></i> {{candidate["gender"]}}<br />
              <i class="bx bxs-home"></i> {{candidate["house"]}}
              </p>
              <div class="progress">
                <div
                    class="progress-bar bg-info"
                    role="progressbar"
                    style="width: {{candidate["percentage"]}}%"
                    aria-valuenow="{{candidate["percentage"]}}"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    >
                    
                </div>
              </div>
              <span class="text-info">{{candidate["percentage"]}}%</span>
            </div>
          </div>
        </div>
      {% endfor %}
      </div>
    </div>
  </div>
    {% endfor %}
  </section>
</div>
{% endblock %}

{% block style %}
<style>

.res-table-cont {
  max-height: 30rem;
  overflow: auto;
}

</style>
{% endblock style %}

{% block scripts %}
{% endblock scripts %}
